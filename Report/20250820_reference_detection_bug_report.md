# 参照検出バグレポート - 急傾斜地法の異常参照

生成日時: 2025年8月20日

## 問題の概要

「急傾斜地の崩壊による災害の防止に関する法律」（最大26条）への参照が67件検出されていますが、その多くが誤検出です。

## 誤検出の例

| 参照元法令 | 検出された参照テキスト | 実際の条文数 | 問題点 |
|-----------|----------------------|------------|--------|
| 関税定率法 | 「急傾斜地の崩壊による災害の防止に関する法第86条」 | 最大26条 | 86条は存在しない |
| 農林中央金庫法 | 「急傾斜地の崩壊による災害の防止に関する法第99条」 | 最大26条 | 99条は存在しない |
| 保険業法 | 「急傾斜地の崩壊による災害の防止に関する法第94条」 | 最大26条 | 94条は存在しない |

## 原因分析

### 検出パターンの問題

```typescript
// 問題のあるパターン（detector.ts）
const pattern2 = /([^、。\s（）]*法)第([一二三四五六七八九十百千]+)条/g;
```

このパターンは「法」の前の任意の文字列を法令名として抽出しています。

### 実際の誤検出メカニズム

元の文章（推定）:
```
「○○に関する法律第86条の規定により、急傾斜地の崩壊による災害の防止に関する...」
```

誤検出:
```
「急傾斜地の崩壊による災害の防止に関する法」+ 「第86条」
```

パターンは文脈を無視して「法」の直前までを法令名として抽出してしまいます。

## 影響範囲

### 影響を受ける可能性のある法令パターン

1. **長い名称の法令**
   - 「○○による災害の防止に関する法律」
   - 「○○の促進に関する法律」
   - 「○○の確保に関する法律」

2. **「法」で終わらない場合の誤マッチ**
   - 「○○する方法」→「方法第○条」
   - 「○○の手法」→「手法第○条」

## 修正案

### 1. パターンの改善

```typescript
// 修正案1: 法令名パターンを厳密化
const lawNamePattern = /(?:^|[、。\s])([^、。\s]{2,30}(?:法律|法|令|規則|条例))(?:（[^）]+）)?第([一二三四五六七八九十百千]+)条/g;

// 修正案2: 既知の法令辞書との照合を必須化
if (this.lawDictionary.has(lawName) || this.isValidLawName(lawName)) {
  // 参照として採用
}
```

### 2. 検証ロジックの追加

```typescript
// 条文番号の妥当性チェック
function validateArticleNumber(lawId: string, articleNum: number): boolean {
  const maxArticles = this.getMaxArticles(lawId);
  return articleNum <= maxArticles;
}
```

### 3. 信頼度スコアの調整

```typescript
// 法令名の長さによる信頼度調整
const nameLength = lawName.length;
if (nameLength > 20) {
  confidence *= 0.7; // 長すぎる法令名は信頼度を下げる
}
```

## 推奨アクション

### 即座の対応

1. **誤検出データの削除**
```sql
DELETE FROM Reference 
WHERE targetLawId = '344AC0000000057' 
AND CAST(REGEXP_REPLACE(referenceText, '[^0-9]', '', 'g') AS INTEGER) > 26;
```

2. **検出パターンの修正**
   - detector.tsのパターンを改善
   - 法令辞書との照合を強化

3. **再検出の実行**
   - 修正後のパターンで全法令を再処理
   - Neo4jデータの更新

### 中期的な改善

1. **法令メタデータの活用**
   - 各法令の最大条文数を記録
   - 参照検証時に活用

2. **コンテキスト解析の強化**
   - 文の構造を解析
   - 真の法令名を特定

3. **LLMによる検証**
   - 疑わしい参照をLLMでチェック
   - 信頼度スコアの再計算

## 結論

急傾斜地法への異常な参照は、検出パターンが「法」の前の任意の文字列を法令名として誤認識することが原因です。この問題は他の長い名称の法令でも発生している可能性が高く、早急な修正が必要です。

### 影響
- 誤検出率: 約80%（67件中54件が誤り）
- 影響法令数: 推定100以上
- データ品質への影響: 重大

### 修正優先度: **高**

---

*レポート作成: LawFinder 参照検出分析システム*
# LawFinder ビルドスクリプトガイド

## 概要

LawFinderには複数の静的サイト生成スクリプトがあり、それぞれ異なる目的と機能を持っています。

## 推奨される使用シナリオ

### 1. **開発時**: `build:static:egov`（標準的UI）
```bash
npm run build:static:egov
```
- 高速処理（数秒で完了）
- 安定したUI確認
- オフラインで動作
- e-Gov準拠の標準的なUIで最終形に近い

### 2. **詳細分析用**: `build:static:llm`（高精度解析）
```bash
npm run build:static:llm
```
- 研究・分析目的
- 複雑な参照関係の検証
- AIによる高度な参照検出が必要な場合
- 新しい法令の初回解析

### 3. **本番用**: 1 + 2 の組み合わせ

**推奨ワークフロー**:
```bash
# Step 1: LLMで高精度解析を実行（初回のみ）
npm run build:static:llm

# Step 2: 解析結果を保存/キャッシュ
# （将来的に実装予定）

# Step 3: e-Govスタイルで高速に表示（日常的に使用）
npm run build:static:egov
```

この組み合わせにより：
- **初回のみ**LLMで詳細解析（時間をかけて高精度）
- **日常的には**e-Govスタイルで高速表示
- 将来的に解析結果を再利用可能に

## 各ビルドスクリプトの詳細

### 1. build:static:egov - e-Govスタイル版（推奨）

#### コマンド
```bash
npm run build:static:egov
```

#### 概要
日本政府のe-Gov法令検索（https://laws.e-gov.go.jp）と同じUIデザインを採用した静的サイト生成スクリプトです。

#### 主な特徴
- **e-Gov準拠のレイアウト**
  - 左サイドバー固定目次（独立スクロール）
  - メインコンテンツエリア（白背景）
  - プロフェッショナルな外観

- **階層的な条文表示**
  - ぶら下がりインデント完全実装
  - 項番号: 右寄せ30px幅
  - 号番号: 右寄せ40px幅
  - イロハ: 右寄せ30px幅

- **シンプルな条文区切り**
  - 条文間は細い線のみ
  - 文書として連続的に表示

- **参照リンクの色分け**
  - 内部参照: 青色（#0066cc）
  - 外部参照: 赤色（#dc3545）
  - 相対参照: 緑色（#28a745）

#### 処理性能
- **処理速度**: 高速（数秒）
- **メモリ使用**: 低
- **出力サイズ**: 小

### 2. build:static:llm - 実LLM版

#### コマンド
```bash
npm run build:static:llm
```

#### 概要
Ollama/Mistralによる実際のAI解析を行う高精度版です。

#### 主な特徴
- **ハイブリッド解析**
  - パターンマッチング＋AI解析
  - 文脈を考慮した参照検出
  - 動的な信頼度評価

- **高精度**
  - 複雑な参照パターンの検出
  - 曖昧な参照の解決
  - 信頼度スコア付与

#### 必要条件
- Ollamaが起動している
- Mistralモデルがインストール済み
- 十分な処理時間（法令1つあたり20-60秒）

### 3. build:static:mock - モックLLM版

#### コマンド
```bash
npm run build:static:mock
```

#### 概要
LLM解析をシミュレートする開発・テスト用バージョンです。

#### 主な特徴
- LLMをシミュレート（実際のAPIは呼ばない）
- 高速処理
- オフライン動作可能
- 固定の信頼度スコア（85-95%）

#### 用途
- UIデザインの確認
- 機能テスト
- デモンストレーション

### 4. build:static:site - PWA版

#### コマンド
```bash
npm run build:static:site
```

#### 概要
Progressive Web App対応版です。

#### 主な特徴
- Service Workerでオフライン動作
- インストール可能（PWA）
- 検索インデックスの分割読み込み
- モバイル最適化

#### 用途
- モバイルアプリ的な使用
- オフライン環境
- 高速検索が必要な場合

## 機能比較表

| 機能 | egov | llm | mock | site |
|------|------|-----|------|------|
| **処理速度** | 高速 | 低速 | 高速 | 高速 |
| **AI解析** | なし | 実LLM | シミュレート | なし |
| **デザイン** | e-Gov準拠 | モダン | モダン | モダン |
| **オフライン** | ✅ | ❌ | ✅ | ✅ |
| **PWA対応** | ❌ | ❌ | ❌ | ✅ |
| **目次スクロール** | ✅ | ❌ | ❌ | ❌ |
| **ぶら下がりインデント** | ✅ | ✅ | ✅ | ✅ |
| **参照精度** | 中 | 高 | 中 | 中 |
| **用途** | 開発・本番 | 詳細分析 | テスト | モバイル |

## トラブルシューティング

### LLM版が動作しない場合

1. **Ollamaが起動しているか確認**
```bash
systemctl status ollama
```

2. **Mistralモデルがインストールされているか確認**
```bash
ollama list
```

3. **必要に応じてモデルをインストール**
```bash
ollama pull mistral
```

4. **起動スクリプトを使用**
```bash
./scripts/startup.sh
```

### e-Gov版のスタイルが崩れる場合

- ブラウザのキャッシュをクリアしてリロード
- `dist/static/egov/` ディレクトリを削除して再ビルド

### 参照リンクが機能しない場合

- JavaScriptが有効になっているか確認
- コンソールにエラーがないか確認（F12）

## 今後の拡張予定

1. **キャッシュ機能**
   - LLM解析結果の永続化
   - インクリメンタルビルド対応

2. **統合ビルドコマンド**
   - `npm run build:production` で自動的にLLM→eGov実行

3. **差分検出**
   - 前回ビルドからの変更分のみ処理

4. **並列処理**
   - 複数法令の同時処理で高速化
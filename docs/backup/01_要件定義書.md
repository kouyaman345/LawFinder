# 01_要件定義書

**作成日**: 2025年8月21日  
**対象プロジェクト**: LawFinder  
**ステータス**: Phase 2実装中  

## 1. プロジェクト概要

### 1.1 背景と目的

LawFinderは、日本政府が公開する法令標準XMLファイルを活用し、法令間の参照関係を自動検出・分析する法令検索・法改正支援システムです。

**主要目的:**
- 法令構造の可視化と精密な検索
- 法令間の参照関係の完全な検出と可視化  
- 改正影響（ハネ改正）の自動分析と通知
- AI支援による参照関係の精査と検証
- 法令編集業務の効率化

### 1.2 対象ユーザー

**Phase 1: 静的法令閲覧サイト**
- 一般市民
- 法学研究者
- 法務関係者

**Phase 2: 法令改正支援システム**
- 政府法制局職員
- 各省庁の法令起案担当者
- 立法支援者

### 1.3 プロジェクト特徴

- **政府標準XML準拠**: e-Gov法令データベースと同一のデータ形式
- **AI強化分析**: ローカルLLM + GPT-4oによるハイブリッド分析
- **ハイブリッドDB構成**: PostgreSQL + Neo4jの最適組み合わせ
- **高精度参照検出**: 誤検出率5%以下の究極の参照検出エンジン

## 2. フェーズ別機能要件

### 2.1 Phase 1: 静的法令閲覧サイト（実装完了）

#### 基本機能
- **FR-001**: 政府標準XML形式の法令データ解析と構造化保存
- **FR-002**: 法令、条、項、号の階層構造表示
- **FR-003**: 法令メタデータの管理（公布日、施行日、改正履歴）
- **FR-004**: 条文からの参照関係自動抽出（精度95%以上）
- **FR-005**: 参照先への自動ハイパーリンク生成
- **FR-006**: クライアントサイド全文検索機能
- **FR-007**: PWA対応によるオフライン閲覧
- **FR-008**: レスポンシブデザイン（PC/タブレット/スマートフォン対応）

#### 参照検出機能
- **FR-009**: 内部参照検出（同一法令内の条文間参照）
- **FR-010**: 外部参照検出（他法令への参照）
- **FR-011**: 相対参照検出（前条、次項など）
- **FR-012**: 複合参照検出（複数条文の同時参照）
- **FR-013**: 準用・読み替え・みなし規定の検出
- **FR-014**: 参照タイプの自動分類（7種類）

### 2.2 Phase 2: 法令改正支援システム（実装中）

#### 高度な分析機能
- **FR-015**: ハネ改正の自動検出（多段階影響分析）
- **FR-016**: 改正影響範囲の可視化（グラフ表示）
- **FR-017**: 参照関係のグラフビジュアライゼーション
- **FR-018**: 改正シミュレーション機能
- **FR-019**: 新旧対照表の自動生成

#### AI支援機能
- **FR-020**: ローカルLLM（Llama-3-ELYZA-JP-8B）による基本分析
- **FR-021**: GPT-4oによる高度な参照関係精査
- **FR-022**: 曖昧な参照の自動解決
- **FR-023**: 参照関係の信頼度スコア付与
- **FR-024**: 参照ミスの自動検出と修正提案

#### ユーザー管理・権限制御
- **FR-025**: JWT認証システム
- **FR-026**: ロールベースアクセス制御（管理者/編集者/閲覧者）
- **FR-027**: 組織別アクセス管理
- **FR-028**: 操作ログの記録と監査

#### データ管理
- **FR-029**: Neo4jによる参照関係グラフ管理
- **FR-030**: PostgreSQLによる法令本体データ管理
- **FR-031**: ハイブリッドDB統合アクセス
- **FR-032**: データ同期とバックアップ

## 3. 非機能要件

### 3.1 性能要件

| 項目 | Phase 1 | Phase 2 |
|------|---------|---------|
| 初期ページ読み込み | < 3秒 | < 3秒 |
| 法令詳細表示 | < 2秒 | < 2秒 |
| 参照分析実行 | - | < 5秒（深度3） |
| グラフ描画 | - | < 1秒 |
| 同時接続数 | 1,000人 | 100人 |

### 3.2 可用性要件

- システム稼働率: 99.5%以上
- 24時間365日利用可能（計画停止除く）
- 障害時の復旧時間: 4時間以内

### 3.3 スケーラビリティ要件

- 法令データ: 10,000件以上対応
- 条文数: 100万条以上対応
- 参照関係: 100万件以上対応
- ユーザー数: 1,000人以上対応

### 3.4 セキュリティ要件

- HTTPS通信の強制
- SQLインジェクション対策（Prisma ORM使用）
- XSS対策（サニタイゼーション）
- CSRF対策（トークン検証）
- 認証情報の暗号化保存
- 操作ログの記録

### 3.5 互換性要件

**ブラウザ対応**
- Chrome: 最新2バージョン
- Firefox: 最新2バージョン
- Safari: 最新2バージョン
- Edge: 最新2バージョン

**デバイス対応**
- デスクトップPC（1920x1080以上）
- タブレット（1024x768以上）
- スマートフォン（375x667以上）

## 4. 技術要件

### 4.1 システム構成

**Phase 1: 静的サイト**
- フロントエンド: React + Next.js 15（Static Export）
- ホスティング: GitHub Pages / Netlify / Vercel
- データ処理: Node.js + TypeScript
- LLM: Ollama（Llama-3-ELYZA-JP-8B）

**Phase 2: フルスタックアプリ**
- フロントエンド: React + Next.js 15（App Router）
- バックエンド: Next.js API Routes
- データベース: PostgreSQL + Neo4j
- キャッシュ: Redis
- 認証: JWT
- AI: Ollama + OpenAI GPT-4o

### 4.2 データ要件

**法令データ**
- フォーマット: 政府標準XML
- 総データ量: 約3.2GB
- ファイル数: 約10,000件
- エンコーディング: UTF-8

**参照関係データ**
- 精度目標: 95%以上
- 信頼度スコア: 0.0-1.0
- 検出タイプ: 7種類の参照パターン

## 5. 制約事項

### 5.1 技術的制約

- 政府標準XML形式への依存
- ローカルLLMのメモリ要件（8GB以上）
- OpenAI API利用制限（コスト管理）
- Neo4jライセンス（Community Edition使用）

### 5.2 運用制約

- 法令データの更新頻度（日次〜週次）
- バックアップ保持期間（30日）
- ログ保持期間（30日）
- ユーザーサポート（平日9-17時）

### 5.3 法的制約

- 個人情報保護法への準拠
- 政府セキュリティ基準への準拠
- 著作権法への準拠（法令データの利用）

## 6. 受入基準

### 6.1 Phase 1

- [ ] 全法令の静的HTML生成完了
- [ ] 参照リンクの正確性95%以上
- [ ] PWA化によるオフライン対応
- [ ] モバイル対応完了
- [ ] 検索機能の正常動作

### 6.2 Phase 2

- [ ] Neo4j統合完了
- [ ] ハネ改正分析機能の実装
- [ ] AI参照検証機能の実装
- [ ] ユーザー認証システムの実装
- [ ] 管理画面の実装

## 7. 品質基準

### 7.1 参照検出品質

- 精度（Precision）: 95%以上
- 再現率（Recall）: 95%以上
- F1スコア: 95%以上
- 信頼度スコア平均: 0.8以上

### 7.2 システム品質

- テストカバレッジ: 80%以上
- コードレビュー実施率: 100%
- セキュリティ監査実施: 月次
- パフォーマンステスト実施: リリース前

## 8. 今後の拡張計画

### 8.1 短期（3ヶ月）

- 全文検索エンジンの高度化
- グラフビジュアライゼーションの改善
- API公開と外部連携

### 8.2 中期（6ヶ月）

- 自然言語による法令検索
- 改正予定法令の事前影響予測
- 多言語対応（英語）

### 8.3 長期（1年）

- AI法令作成支援
- 国際法令データベースとの連携
- ブロックチェーンによる改正履歴管理

## 9. リスク分析

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| AI APIコスト超過 | 高 | 中 | 使用量制限、キャッシング |
| 参照検出精度不足 | 高 | 低 | 段階的改善、人手検証 |
| Neo4j性能問題 | 中 | 低 | インデックス最適化 |
| 法令形式変更 | 中 | 低 | 柔軟なパーサー設計 |
| セキュリティ脆弱性 | 高 | 低 | 定期監査、ペネトレーションテスト |

## 10. 成功指標

### 10.1 定量指標

**Phase 1**
- 月間ページビュー: 10万PV以上
- 平均滞在時間: 5分以上
- 参照リンククリック率: 30%以上

**Phase 2**
- 導入省庁数: 10省庁以上
- 改正作業効率化: 50%改善
- ユーザー満足度: 80%以上

### 10.2 定性指標

- ユーザビリティの向上
- 法令検索業務の効率化
- 改正ミスの削減
- 法令理解の促進

---

**改訂履歴**

| バージョン | 日付 | 変更内容 |
|----------|------|----------|
| 1.0 | 2025-08-21 | 初版作成（38個の設計書を統合） |
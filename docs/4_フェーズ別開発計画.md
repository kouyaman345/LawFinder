# LawFinder フェーズ別開発計画

## 概要
段階的なアプローチにより、早期に価値を提供しながら、徐々に高度な機能を追加していきます。

## Phase 1: 静的法令閲覧サイト（3ヶ月）

### 目的
- 法令間の参照関係を可視化した静的サイトを構築
- 今まで不明確だった法令の関係性を簡単に把握できるようにする
- 最小限のインフラで運用可能

### 主要機能
1. **法令閲覧機能**
   - 法令の条文を階層的に表示
   - 読みやすいレイアウトとナビゲーション

2. **自動リンク生成**
   - 「第○条」「○○法」などの参照を自動的にハイパーリンク化
   - クリックで参照先法令・条文にジャンプ

3. **参照関係の可視化**
   - 各条文の参照元・参照先をサイドバーに表示
   - 簡易的な関係図の表示

4. **検索機能**
   - クライアントサイドでの全文検索（lunr.js等）
   - 法令名、条文番号での絞り込み

### 技術構成
```
【データ処理】
- Node.js: XMLパーサー、リンク抽出
- 正規表現: 参照パターンマッチング

【静的サイト生成】
- Next.js (Static Export)
- あるいは Gatsby.js

【フロントエンド】
- React
- Tailwind CSS
- クライアントサイド検索

【ホスティング】
- GitHub Pages / Netlify / Vercel
- CDN配信
```

### 実装手順

#### Step 1: データ処理パイプライン
```javascript
// 1. XMLファイルから法令データを抽出
const laws = await parseLawXMLFiles('./laws_data');

// 2. 参照関係を抽出
const references = extractReferences(laws);

// 3. 静的データファイルを生成
await generateStaticData(laws, references);
```

#### Step 2: リンク抽出エンジン
```javascript
class ReferenceExtractor {
  patterns = [
    // 条文参照パターン
    { regex: /第(\d+)条/, type: 'article' },
    // 法令参照パターン
    { regex: /([\w\s]+法)(?:律第)?(\d+号)?/, type: 'law' },
    // 準用パターン
    { regex: /第(\d+)条.*準用/, type: 'apply' }
  ];

  extractFromText(text, currentLawId) {
    const references = [];
    
    for (const pattern of this.patterns) {
      const matches = text.matchAll(pattern.regex);
      for (const match of matches) {
        references.push({
          type: pattern.type,
          text: match[0],
          target: this.resolveReference(match, currentLawId)
        });
      }
    }
    
    return references;
  }
}
```

#### Step 3: 静的HTML生成
```javascript
// Next.js の getStaticProps/getStaticPaths を使用
export async function getStaticProps({ params }) {
  const lawData = await getLawData(params.lawId);
  const references = await getReferences(params.lawId);
  
  return {
    props: {
      law: lawData,
      references: references,
      // リンクを含むHTMLを事前生成
      processedContent: processContent(lawData.content, references)
    }
  };
}
```

### Phase 1 成果物
- 全法令の静的HTMLファイル（約1万ファイルを個別管理）
- 法令間の相互リンク（ローカルLLMで強化）
- 検索可能なインデックス（分割・圧縮配信）
- モバイル対応のレスポンシブデザイン
- PWA化によるオフライン対応

### 大規模データへの対応策（3.2GBの法令データ）

#### 1. データ分割戦略
- **個別ファイル化**: 各法令を独立HTMLファイルとして管理（平均300KB/ファイル）
- **インデックス分割**: 検索インデックスを10-20ファイルに分割
- **チャンクローディング**: 必要な部分のみ動的読み込み

#### 2. パフォーマンス最適化
- **Lazy Loading**: 仮想スクロールで表示範囲のみロード
- **Service Worker**: インテリジェントキャッシュ戦略
- **圧縮配信**: Brotli/Gzipで転送サイズを最大70%削減
- **CDNエッジキャッシュ**: 世界中で高速アクセス

#### 3. ユーザー体験の向上
- **初期表示高速化**: コアファイルのみでアプリ起動（1秒以内）
- **プログレッシブエンハンスメント**: 使うほどキャッシュが充実
- **オフライン対応**: PWAで一度見た法令はオフラインでも閲覧可能

### メリット
- **低コスト**: 静的ホスティングのみで運用可能
- **高速**: CDN配信とLazy Loadingで大規模データでも快適
- **安定性**: データベース不要で障害リスク最小
- **SEO対応**: 静的HTMLで検索エンジン最適化
- **スケーラビリティ**: データ量が増えても同じアーキテクチャで対応可能

---

## Phase 2: 法令改正支援システム（3-4ヶ月）

### 目的
- 役所向けの法令改正作業支援
- ハネ改正の自動検出と影響分析
- AIを活用した高度な分析機能

### 追加機能
1. **ハネ改正検出**
   - 改正対象条文の被参照箇所を自動検出
   - 影響範囲の可視化（ネットワーク図）
   - 影響度のスコアリング

2. **改正シミュレーション**
   - 改正案の入力と影響プレビュー
   - 新旧対照表の自動生成
   - 矛盾・不整合の検出

3. **AI支援機能**
   - GPT-4oによる参照関係の精査
   - 改正文案の自動生成支援
   - 類似条文の検索・提案

4. **ユーザー管理**
   - 省庁・部署別のアクセス管理
   - 改正作業の履歴管理
   - コラボレーション機能

### 技術構成（Phase 1に追加）
```
【バックエンド】
- Node.js + Express.js
- GraphQL (Apollo Server)

【データベース】
- Neo4j: 参照関係グラフ
- PostgreSQL: メタデータ、ユーザー情報
- Redis: キャッシュ、セッション

【AI/ML】
- OpenAI API (GPT-4o)
- LangChain

【認証・セキュリティ】
- Auth0 / Azure AD B2C
- JWT認証
```

### アーキテクチャ
```
┌─────────────────┐     ┌─────────────────┐
│   Static Site   │     │   Admin Portal  │
│   (Phase 1)     │     │   (Phase 2)     │
└────────┬────────┘     └────────┬────────┘
         │                       │
         │                       ▼
         │              ┌─────────────────┐
         │              │   API Gateway   │
         │              └────────┬────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐     ┌─────────────────┐
│   Static Files  │     │ Express.js API  │
│   (CDN)         │     └────────┬────────┘
└─────────────────┘              │
                        ┌────────┼────────┐
                        ▼        ▼        ▼
                    ┌──────┐ ┌──────┐ ┌──────┐
                    │Neo4j │ │Redis │ │PG SQL│
                    └──────┘ └──────┘ └──────┘
```

### Phase 2 の価値提案
1. **業務効率化**
   - 手作業での影響調査を自動化
   - 改正ミスのリスク削減

2. **品質向上**
   - AIによる整合性チェック
   - 過去の改正パターンの学習

3. **透明性向上**
   - 改正プロセスの可視化
   - 影響範囲の明確化

### 移行計画
- Phase 1の静的サイトは継続運用
- Phase 2の機能は別URLで提供（例: admin.lawfinder.jp）
- 段階的にPhase 2の機能を追加

### 成功指標
- **Phase 1**: 月間10万PV、平均滞在時間5分以上
- **Phase 2**: 10省庁での導入、改正作業時間50%削減

## リスクと対策

### Phase 1のリスク
- **参照抽出の精度**: 段階的に改善、手動修正機能
- **データ更新**: 定期的な再生成バッチ

### Phase 2のリスク
- **セキュリティ**: 政府セキュリティ基準への準拠
- **AIコスト**: 使用量制限とキャッシング

## まとめ
Phase 1で基盤を確立し、ユーザーフィードバックを収集しながら、Phase 2で高度な機能を追加することで、着実にシステムを成長させていきます。